@inherits WizardStepBase

<EditForm Model="_context" OnValidSubmit="NextStep">

<div class="container">
    <div class="row">
        <div class="col-4 flex-grow-1 text-end">
            <p>Select the Olod for the exam list:</p>
        </div>
        <div class="col-7 flex-grow-1">
                @if (OlodNames is not null)
                {
                    <InputSelectComponent T="string" E="string" 
                        @bind-Value="_context.olod"  
                        ValueSource="OlodNames.Order()" 
                        ToText="s => s"/>
                }
        </div>
    </div>
    <div class="row">
        <div class="col-4 flex-grow-1 text-end">
            <p>Select the type of exam:</p>
        </div>
        <div class="col-7 flex-grow-1">
            <InputSelectComponent T="ExamType" E="ExamType" 
                @bind-Value="_context.examType" 
                ValueSource="Enum.GetValues(typeof(ExamType)).Cast<ExamType>()" 
                ToText="e => e.ToString()[0] + e.ToString()[1..].ToLower()" />
        </div>
    </div>
    <div class="row">
        <div class="col-4 flex-grow-1 text-end">
            <p>What to do with TIAO/VC:</p>
        </div>
        <div class="col-7 flex-grow-1">
            <InputSelectComponent T="DistanceLearningClassroomType" E="DistanceLearningClassroomType" 
                @bind-Value="_context.distanceLearningClassroomType"
                ValueSource="Enum.GetValues(typeof(DistanceLearningClassroomType)).Cast<DistanceLearningClassroomType>()"
                ToText="e => e.ToString()[0] + e.ToString()[1..].ToLower()"/>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-auto ">
            <button type="submit" class="btn btn-primary">Continue</button>
        </div>
    </div>
</div>
</EditForm>
@code {
    //Selecteer OLOD, Type examen & Lokaal TIAO/VC
    public class Context
    {
        public string olod;
        public ExamType examType;
        public DistanceLearningClassroomType distanceLearningClassroomType;

        public Context()
        {
            olod = "Advanced Software Development I";
            examType = ExamType.WRITTEN;
            distanceLearningClassroomType = DistanceLearningClassroomType.Spread;
        }

    }

    public required Context _context = new Context();
    public required IEnumerable<string> OlodNames;

    protected async override Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        OlodNames = Wiz.WizardModel.Students.Values.SelectMany(s => s.Olods).Select(o => o.Name).ToHashSet();
    }

    private async Task NextStep()
    {
        Wiz.WizardModel.Olod = _context.olod;
        Wiz.WizardModel.ExamType = _context.examType;
        Wiz.WizardModel.DistanceLearningClassroomType = _context.distanceLearningClassroomType;
        Wiz.WizardModel.RoomChoices = new Models.RoomChoices(_context.examType);
        await GoToNextStep();
    }

}
